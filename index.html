<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>‚ö° TRIDENT V4.2 - KINETIC</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap');
        body { background: #050505; color: #d4d4d8; font-family: 'JetBrains Mono', monospace; overflow: hidden; }
        .win-gradient { background: linear-gradient(90deg, #ef4444 0%, #18181b 50%, #22c55e 100%); }
        .win-pointer { width: 4px; height: 32px; background: #fff; position: absolute; top: -6px; transition: all 0.4s cubic-bezier(0.18, 0.89, 0.32, 1.28); box-shadow: 0 0 15px #fff; z-index: 40; }
        .avg-pointer { width: 2px; height: 32px; background: rgba(255,255,255,0.6); position: absolute; top: -6px; transition: all 0.8s; border: 1px dashed #fff; z-index: 30; }
        .h1-pointer { width: 2px; height: 32px; background: #f59e0b; position: absolute; top: -6px; transition: all 1.2s; border: 1px dotted #f59e0b; z-index: 20; }
        .h4-pointer { width: 2px; height: 32px; background: #3b82f6; position: absolute; top: -6px; transition: all 1.5s; z-index: 10; }
        .card-stat { background: #0f0f11; border: 1px solid #1f1f23; transition: 0.3s; }
        .signal-buy { border: 2px solid #10b981; }
        .signal-sell { border: 2px solid #ef4444; }
        .signal-hold { border: 2px solid #a855f7; box-shadow: 0 0 20px rgba(168,85,247,0.2); }
        .del-btn { opacity: 0; transition: 0.2s; position: absolute; top: 4px; right: 8px; z-index: 50; }
        .card-stat:hover .del-btn { opacity: 1; }
    </style>
</head>
<body class="flex flex-col h-screen p-4">
    <div class="flex justify-between items-center mb-6">
        <div>
            <h1 class="text-xl font-black text-white italic">TRIDENT V4.2 <span class="text-xs font-normal text-zinc-500 uppercase tracking-tighter">Kinetic Engine</span></h1>
            <p class="text-[9px] text-zinc-600">Âº∑Âº±ÊúâÂ∫è‰øÆÊ≠£ | ËóçÂØ¶:4H | ÈªÉÈªû:1H | ÂØ¶Á∑ö:NOW</p>
        </div>
        <div class="flex gap-2">
            <input type="text" id="search-input" placeholder="ÊêúÂ∞ã..." class="bg-zinc-900 border border-zinc-800 rounded px-3 py-1 text-sm text-white outline-none w-32 focus:border-amber-500">
            <button onclick="handleSearch()" class="bg-white text-black px-4 py-1 rounded font-bold text-sm">ËøΩËπ§</button>
        </div>
    </div>
    <div id="main-panel" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 overflow-y-auto pb-24"></div>
<script>
    const EXCLUDE = ['BTCUSDT','ETHUSDT','SOLUSDT','XRPUSDT','BNBUSDT','DOGEUSDT','ADAUSDT','TRXUSDT','AVAXUSDT','SHIBUSDT','TONUSDT','LINKUSDT','DOTUSDT','NEARUSDT','MATICUSDT','BCHUSDT','LTCUSDT','ICPUSDT','UNIUSDT','LEOUSDT','ETCUSDT','XLMUSDT','BNXUSDT'];
    let marketData = {}; 
    let manualExcludes = new Set();

    async function initStream(symbol) {
        if (marketData[symbol]) return;
        let d4=0, d1=0;
        try {
            const k = await fetch(`https://fapi.binance.com/fapi/v1/klines?symbol=${symbol}&interval=1m&limit=240`).then(r=>r.json());
            k.forEach((v, i) => { let d = parseFloat(v[10]) - (parseFloat(v[7]) - parseFloat(v[10])); d4+=d; if(i>=180) d1+=d; });
        } catch(e) {}
        const ws = new WebSocket(`wss://fstream.binance.com/ws/${symbol.toLowerCase()}@aggTrade`);
        marketData[symbol] = { 
            symbol, winRate: 50, avgWinRate5m: 50, avgWinRate1h: 50+(d1/5000000*50), avgWinRate4h: 50+(d4/20000000*50),
            delta: d4, lastPrice: 0, maxDelta: 20000, history5m: [], history1h: [], history4h: [], hasActive: false, signal: 'NEUTRAL'
        };
        ws.onmessage = (e) => {
            const d = JSON.parse(e.data); const v = parseFloat(d.q) * parseFloat(d.p);
            if (v < 300) return;
            let p = marketData[symbol]; p.lastPrice = d.p; p.hasActive = true;
            
            // Ê†∏ÂøÉ‰øÆÊ≠£ÔºöÂãïÊÖã Delta ËàáÂΩàÊÄßÂàÜÊØç
            p.delta = (p.delta * 0.9995) + (d.m ? -v : v); 
            p.maxDelta = Math.max(p.maxDelta * 0.9999, Math.abs(p.delta), 20000);
            
            // ‰ΩøÁî® Math.tanh ËÆìÊåáÈáùÊé•Ëøë 100% ÊôÇÁî¢ÁîüÂ∑®Â§ßÈòªÂäõ (Âº∑Âº±ÊúâÂ∫è)
            let ratio = p.delta / p.maxDelta;
            let smoothRatio = Math.tanh(ratio * 1.8); 
            let t = 50 + (smoothRatio * 50);
            
            p.winRate = (p.winRate * 0.9) + (t * 0.1);
            
            if(!p.t5 || Date.now()-p.t5>8000) { p.history5m.push(p.winRate); if(p.history5m.length>40) p.history5m.shift(); p.avgWinRate5m=p.history5m.reduce((a,b)=>a+b,0)/p.history5m.length; p.t5=Date.now(); }
            if(!p.t1 || Date.now()-p.t1>30000) { p.history1h.push(p.winRate); if(p.history1h.length>120) p.history1h.shift(); p.avgWinRate1h=p.history1h.reduce((a,b)=>a+b,0)/p.history1h.length; p.t1=Date.now(); }
            if(!p.t4 || Date.now()-p.t4>120000) { p.history4h.push(p.winRate); if(p.history4h.length>120) p.history4h.shift(); p.avgWinRate4h=p.history4h.reduce((a,b)=>a+b,0)/p.history4h.length; p.t4=Date.now(); }
            if (p.winRate > 92) p.signal = 'HOLD'; else if (p.winRate > p.avgWinRate5m+1.5) p.signal = 'BUY'; else if (p.winRate < p.avgWinRate5m-1.2) p.signal = 'SELL'; else p.signal = 'NEUTRAL';
        };
        marketData[symbol].ws = ws;
    }

    async function scan() {
        const d = await fetch('https://fapi.binance.com/fapi/v1/ticker/24hr').then(r=>r.json());
        d.filter(s => s.symbol.endsWith('USDT') && !EXCLUDE.includes(s.symbol) && !manualExcludes.has(s.symbol))
         .sort((a,b) => (parseFloat(b.quoteVolume)*Math.abs(parseFloat(b.priceChangePercent))) - (parseFloat(a.quoteVolume)*Math.abs(parseFloat(a.priceChangePercent))))
         .slice(0, 16).forEach(i => initStream(i.symbol));
    }

    function removeSymbol(s) { if(marketData[s]) { marketData[s].ws.close(); delete marketData[s]; manualExcludes.add(s); document.getElementById(`card-${s}`)?.remove(); scan(); } }

    function render() {
        const panel = document.getElementById('main-panel');
        Object.keys(marketData).filter(s => marketData[s].hasActive).sort((a,b) => marketData[b].winRate - marketData[a].winRate).forEach(s => {
            let item = marketData[s]; let card = document.getElementById(`card-${s}`);
            if (!card) { card = document.createElement('div'); card.id = `card-${s}`; panel.appendChild(card); }
            let sigClass = item.signal==='BUY'?'signal-buy':(item.signal==='SELL'?'signal-sell':(item.signal==='HOLD'?'signal-hold':''));
            card.className = `card-stat p-4 rounded-lg ${sigClass} relative`;
            card.innerHTML = `<button onclick="removeSymbol('${s}')" class="del-btn text-zinc-500 hover:text-white font-bold">√ó</button>
                <div class="flex justify-between items-start mb-2">
                    <div><div class="font-black text-white italic text-base leading-none">${s.replace('USDT','')}</div><div class="text-[9px] text-zinc-500 mt-1 font-mono">$${item.lastPrice}</div></div>
                    <div class="text-right text-[8px] font-bold tracking-tighter leading-tight">
                        <div class="text-blue-500">4H:${item.avgWinRate4h.toFixed(1)}%</div><div class="text-amber-500">1H:${item.avgWinRate1h.toFixed(1)}%</div>
                        <div class="text-zinc-400">5M:${item.avgWinRate5m.toFixed(1)}%</div><div class="text-lg font-black ${item.winRate>50?'text-emerald-500':'text-red-500'}">${item.winRate.toFixed(1)}%</div>
                    </div>
                </div>
                <div class="h-4 w-full win-gradient rounded-sm relative mb-4">
                    <div class="h4-pointer" style="left:${item.avgWinRate4h}%"></div><div class="h1-pointer" style="left:${item.avgWinRate1h}%"></div>
                    <div class="avg-pointer" style="left:${item.avgWinRate5m}%"></div><div class="win-pointer" style="left:${item.winRate}%"></div>
                </div>
                <div class="flex justify-between text-[10px] font-bold uppercase tracking-tighter">
                    <div class="${item.signal==='HOLD'?'text-purple-400':(item.signal==='BUY'?'text-emerald-400':'text-red-400')}">
                        ${item.signal==='BUY'?'‚óè ÈáëÂèâÈÄ≤Â†¥':(item.signal==='SELL'?'‚óè Ê≠ªÂèâÈõ¢Â†¥':(item.signal==='HOLD'?'üî• Âº∑Âã¢‰∫ÆÈªû':'Áõ£Êéß‰∏≠'))}
                    </div><div class="text-zinc-500 font-mono">POW: $${(Math.abs(item.delta)/1000).toFixed(1)}K</div>
                </div>`;
        });
    }
    scan(); setInterval(scan, 10000); setInterval(render, 500);
    document.getElementById('search-input').addEventListener('keypress', (e) => { if(e.key==='Enter') handleSearch(); });
    function handleSearch() { const i = document.getElementById('search-input'); const s = i.value.trim().toUpperCase(); if(s) { initStream(s.endsWith('USDT')?s:s+'USDT'); i.value=''; } }
</script>
</body>
</html>
