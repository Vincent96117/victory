<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚ö° TRIDENT COMMANDER V1.8 - PROP DESK SYSTEM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap');
        body { background: #050505; color: #d4d4d8; font-family: 'JetBrains Mono', monospace; overflow: hidden; }
        .win-gradient { background: linear-gradient(90deg, #ef4444 0%, #18181b 50%, #22c55e 100%); }
        .win-pointer { width: 4px; height: 32px; background: #fff; position: absolute; top: -6px; transition: all 0.3s cubic-bezier(0.1, 0.7, 0.1, 1); box-shadow: 0 0 15px #fff; }
        .card-stat { background: #0f0f11; border: 1px solid #1f1f23; transition: transform 0.2s; }
        .ghost-border { border: 1px solid #f59e0b; background: linear-gradient(180deg, rgba(245, 158, 11, 0.05) 0%, transparent 100%); }
        .fire-bg { background: linear-gradient(180deg, rgba(168, 85, 247, 0.1) 0%, transparent 100%); border: 1px solid #a855f7; }
        .tag-ghost { background: #f59e0b; color: #000; font-size: 10px; font-weight: 900; padding: 1px 6px; border-radius: 3px; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #27272a; border-radius: 10px; }
    </style>
</head>
<body class="flex flex-col h-screen p-4">

    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
        <div>
            <h1 class="text-2xl font-black text-white italic tracking-tighter">TRIDENT COMMANDER <span class="text-xs font-normal text-zinc-500 not-italic">V1.8 PRO</span></h1>
            <p class="text-[10px] text-zinc-500 tracking-widest uppercase">Aggressor Intelligence & Ghost Radar</p>
        </div>
        
        <div class="flex gap-2 w-full md:w-auto">
            <input type="text" id="search-input" placeholder="Ëº∏ÂÖ•Âπ£Á®Æ (Â¶Ç: PEPE)..." 
                class="bg-zinc-900 border border-zinc-800 rounded px-4 py-2 text-sm text-white focus:border-purple-500 outline-none w-full md:w-48">
            <button onclick="handleSearch()" class="bg-white text-black px-6 py-2 rounded font-bold text-sm hover:bg-zinc-200 transition-all">ËøΩËπ§</button>
        </div>
    </div>

    <div id="main-panel" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 overflow-y-auto pb-20">
        </div>

<script>
    const EXCLUDE = ['BTCUSDT','ETHUSDT','SOLUSDT','XRPUSDT','BNBUSDT','BNXUSDT'];
    let marketData = {}; 
    let ghostSymbols = new Set();

    // 1. Â¶ñÊ∞£Èõ∑ÈÅîÔºöÊØè 15 ÁßíÊéÉÊèè‰∏ÄÊ¨°ÂÖ®Â∏ÇÂ†¥ËÉΩÈáè
    async function scanGhosts() {
        try {
            const data = await fetch('https://fapi.binance.com/fapi/v1/ticker/24hr').then(r=>r.json());
            const sorted = data
                .filter(s => s.symbol.endsWith('USDT') && !EXCLUDE.includes(s.symbol))
                .map(s => {
                    const volImpulse = parseFloat(s.quoteVolume) / 288; // 24h/5min ËÉΩÈáè
                    const change = Math.abs(parseFloat(s.priceChangePercent));
                    return { symbol: s.symbol, ghostScore: volImpulse * change };
                })
                .sort((a, b) => b.ghostScore - a.ghostScore)
                .slice(0, 4);

            ghostSymbols.clear();
            sorted.forEach(g => {
                ghostSymbols.add(g.symbol);
                if(!marketData[g.symbol]) initStream(g.symbol);
            });
        } catch(e) { console.error("Radar Error"); }
    }

    // 2. WebSocket Êï∏ÊìöÊµÅÔºöÊ†∏ÂøÉÊ≠∏‰∏ÄÂåñË®àÁÆó
    function initStream(symbol) {
        if (marketData[symbol]) return;
        const ws = new WebSocket(`wss://fstream.binance.com/ws/${symbol.toLowerCase()}@aggTrade`);
        
        marketData[symbol] = {
            symbol: symbol,
            trades: [],
            winRate: 50,
            delta: 0,
            lastPrice: 0,
            maxDelta: 20, // ÂàùÂßãÁ∑©Ë°ùÔºåÈò≤Ê≠¢ÊåáÈáùÁõ¥Êé•ÊíûÁâÜ
            avgSize: 0,
            historyDelta: [],
            isManual: false
        };

        ws.onmessage = (e) => {
            const data = JSON.parse(e.data);
            const size = parseFloat(data.q);
            const isSell = data.m;
            let pool = marketData[symbol];
            pool.lastPrice = parseFloat(data.p);

            // ÂãïÊÖãÂü∫Ê∫ñË®àÁÆó (ÈÅéÂéª 500 Á≠Ü)
            if (pool.trades.length < 500) { pool.trades.push(size); } 
            else { pool.trades.shift(); pool.trades.push(size); }
            pool.avgSize = pool.trades.reduce((a,b)=>a+b,0) / pool.trades.length;

            // Â§ßÂñÆÊ¨äÈáçÔºöË∂ÖÈÅéÂπ≥Âùá 4 ÂÄçÁöÑË¶ñÁÇ∫‰∏ªÂäõÔºåÁµ¶‰∫à 6 ÂÄçÊ¨äÈáç
            const weight = size > pool.avgSize * 4 ? 6 : 1;
            const currentDelta = isSell ? -(size * weight) : (size * weight);
            
            pool.delta += currentDelta;
            pool.historyDelta.push(currentDelta);
            
            // ÊªæÂãïÁ™óÂè£ (Á∂≠ÊåÅ 400 Á≠Ü‰∫§ÊòìÁöÑ‰æµÁï•Â∫¶)
            if (pool.historyDelta.length > 400) {
                pool.delta -= pool.historyDelta.shift();
            }

            // Ê≠∏‰∏ÄÂåñÂãùÁéáÊºîÁÆóÊ≥ï
            // ‰ΩøÁî®ÂãïÊÖãÊ•µÂÄº‰∏¶Âä†ÂÖ•Ë°∞Ê∏õ‰øÇÊï∏ÔºåÁ¢∫‰øùÊåáÈáùÂÖ∑ÂÇôÁâ©ÁêÜÂãïËÉΩÊÑü
            pool.maxDelta = Math.max(pool.maxDelta * 0.999, Math.abs(pool.delta), 5);
            let targetWinRate = 50 + ((pool.delta / pool.maxDelta) * 50);
            
            // Âπ≥ÊªëËôïÁêÜ
            pool.winRate = pool.winRate * 0.7 + targetWinRate * 0.3;
        };
    }

    // 3. ÊêúÂ∞ãÂäüËÉΩ
    function handleSearch() {
        const input = document.getElementById('search-input');
        const s = input.value.trim().toUpperCase();
        if (s) {
            const sym = s.endsWith('USDT') ? s : s + 'USDT';
            initStream(sym);
            if(marketData[sym]) marketData[sym].isManual = true;
            input.value = '';
        }
    }

    // 4. Ê∏≤ÊüìÂºïÊìé
    function render() {
        const panel = document.getElementById('main-panel');
        // ÊéíÂ∫èÔºöÂ¶ñÂπ£ > ÊâãÂãïËøΩËπ§ > ‰∏ÄËà¨
        const sorted = Object.keys(marketData).sort((a,b) => {
            const aG = ghostSymbols.has(a) ? 1 : 0;
            const bG = ghostSymbols.has(b) ? 1 : 0;
            return bG - aG || (marketData[b].isManual - marketData[a].isManual);
        });

        sorted.forEach(s => {
            let item = marketData[s];
            let card = document.getElementById(`card-${s}`);
            if (!card) {
                card = document.createElement('div');
                card.id = `card-${s}`;
                panel.prepend(card);
            }

            const isGhost = ghostSymbols.has(s);
            const isFire = item.winRate > 75 || item.winRate < 25;

            card.className = `card-stat p-4 rounded-lg relative transition-all duration-300 mb-2 ${isGhost ? 'ghost-border shadow-[0_0_15px_rgba(245,158,11,0.1)]' : ''} ${isFire ? 'fire-bg' : ''}`;
            
            card.innerHTML = `
                <div class="flex justify-between items-start mb-3">
                    <div>
                        <div class="flex items-center gap-2 font-bold text-white">
                            <span>${s.replace('USDT','')}</span>
                            ${isGhost ? '<span class="tag-ghost">üî• GHOST</span>' : ''}
                            ${item.isManual ? '<span class="text-[8px] text-zinc-600 border border-zinc-800 px-1">TRACK</span>' : ''}
                        </div>
                        <div class="text-[10px] text-zinc-500 font-mono">$${item.lastPrice.toLocaleString()}</div>
                    </div>
                    <div class="text-right">
                        <div class="text-xl font-black ${item.winRate > 50 ? 'text-emerald-500' : 'text-red-500'}">${item.winRate.toFixed(1)}%</div>
                        <div class="text-[8px] uppercase text-zinc-600">Aggression</div>
                    </div>
                </div>
                <div class="h-4 w-full win-gradient rounded-sm relative mb-4 opacity-90">
                    <div class="win-pointer" style="left: ${item.winRate}%"></div>
                </div>
                <div class="flex justify-between text-[10px] items-center">
                    <div class="text-zinc-400">POWER: <span class="text-zinc-200 font-bold">${Math.abs(item.delta).toFixed(0)}</span></div>
                    <div class="font-bold ${isFire ? 'text-purple-400 animate-pulse' : 'text-zinc-600'}">
                        ${item.winRate > 75 ? 'üöÄ AGGRESSIVE BUY' : (item.winRate < 25 ? 'üíÄ PANIC SELL' : 'NEUTRAL')}
                    </div>
                </div>
            `;
        });
    }

    async function start() {
        await scanGhosts();
        setInterval(scanGhosts, 15000); 
        setInterval(render, 1000);
    }
    document.getElementById('search-input').addEventListener('keypress', (e) => { if(e.key==='Enter') handleSearch(); });
    start();
</script>
</body>
</html>
