<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>⚡ TRIDENT V2.3 - ALT HUNTER PRO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap');
        body { background: #050505; color: #d4d4d8; font-family: 'JetBrains Mono', monospace; overflow: hidden; }
        .win-gradient { background: linear-gradient(90deg, #ef4444 0%, #18181b 50%, #22c55e 100%); }
        .win-pointer { width: 4px; height: 32px; background: #fff; position: absolute; top: -6px; transition: all 0.4s cubic-bezier(0.1, 0.7, 0.1, 1); box-shadow: 0 0 15px #fff; }
        .card-stat { background: #0f0f11; border: 1px solid #1f1f23; transition: all 0.3s; }
        .ghost-border { border: 1px solid #f59e0b; background: linear-gradient(180deg, rgba(245, 158, 11, 0.05) 0%, transparent 100%); }
        .tag-ghost { background: #f59e0b; color: #000; font-size: 10px; font-weight: 900; padding: 1px 6px; border-radius: 3px; }
        .fire-bg { background: linear-gradient(180deg, rgba(168, 85, 247, 0.1) 0%, transparent 100%); border: 1px solid #a855f7; }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #27272a; border-radius: 10px; }
    </style>
</head>
<body class="flex flex-col h-screen p-4">

    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
        <div>
            <h1 class="text-2xl font-black text-white italic tracking-tighter text-transparent bg-clip-text bg-gradient-to-r from-white to-zinc-500">
                TRIDENT V2.3 <span class="text-xs font-normal not-italic text-zinc-500">DEEP SCAN</span>
            </h1>
            <p class="text-[10px] text-zinc-500 tracking-widest uppercase">已自動過濾市值前 20 名大幣 | 合約專用</p>
        </div>
        <div class="flex gap-2">
            <input type="text" id="search-input" placeholder="搜尋妖幣 (如: NEIRO)..." 
                class="bg-zinc-900 border border-zinc-800 rounded px-4 py-2 text-sm text-white focus:border-amber-500 outline-none w-48 transition-all">
            <button onclick="handleSearch()" class="bg-amber-500 text-black px-6 py-2 rounded font-bold text-sm hover:bg-amber-400">追蹤</button>
        </div>
    </div>

    <div id="main-panel" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 overflow-y-auto pb-24"></div>

<script>
    // 嚴格黑名單：市值前 20 名與低波動幣種
    const EXCLUDE = [
        'BTCUSDT','ETHUSDT','SOLUSDT','XRPUSDT','BNBUSDT','DOGEUSDT',
        'ADAUSDT','TRXUSDT','AVAXUSDT','SHIBUSDT','TONUSDT','LINKUSDT',
        'DOTUSDT','NEARUSDT','MATICUSDT','BCHUSDT','LTCUSDT','ICPUSDT',
        'UNIUSDT','LEOUSDT','ETCUSDT','XLMUSDT','BNXUSDT'
    ];

    let marketData = {}; 
    let ghostSymbols = new Set();

    // 1. 合約能量掃描引擎
    async function scanGhosts() {
        try {
            const data = await fetch('https://fapi.binance.com/fapi/v1/ticker/24hr').then(r=>r.json());
            const sorted = data.filter(s => s.symbol.endsWith('USDT') && !EXCLUDE.includes(s.symbol))
                .map(s => {
                    const volImpulse = parseFloat(s.quoteVolume);
                    const change = Math.abs(parseFloat(s.priceChangePercent));
                    return { symbol: s.symbol, ghostScore: volImpulse * change };
                })
                .sort((a, b) => b.ghostScore - a.ghostScore).slice(0, 16);
            
            ghostSymbols.clear();
            sorted.forEach(g => { ghostSymbols.add(g.symbol); initStream(g.symbol); });
        } catch(e) { console.error("Scanner Error"); }
    }

    // 2. L3 數據流核心邏輯
    function initStream(symbol) {
        if (marketData[symbol]) return;
        const ws = new WebSocket(`wss://fstream.binance.com/ws/${symbol.toLowerCase()}@aggTrade`);
        
        marketData[symbol] = {
            symbol, winRate: 50, avgWinRate5m: 50, delta: 0, lastPrice: 0, maxDelta: 50, 
            historyDelta: [], historyWinRates: [], isManual: false
        };

        ws.onmessage = (e) => {
            const data = JSON.parse(e.data);
            const size = parseFloat(data.q);
            const isSell = data.m;
            let pool = marketData[symbol];
            pool.lastPrice = parseFloat(data.p);

            // 動態侵略量化
            const currentDelta = isSell ? -size : size;
            pool.delta += currentDelta;
            pool.historyDelta.push(currentDelta);
            if (pool.historyDelta.length > 400) pool.delta -= pool.historyDelta.shift();

            // 歸一化修正（解決熱機與跳閃問題）
            pool.maxDelta = Math.max(pool.maxDelta * 0.9995, Math.abs(pool.delta), 10);
            let targetWinRate = 50 + ((pool.delta / pool.maxDelta) * 50);
            
            // 物理平滑（30% 權重跟隨）
            pool.winRate = pool.winRate * 0.7 + targetWinRate * 0.3;

            // 五分鐘時軌採樣 (每 10 秒計入一次)
            if(!pool.lastSampleTime || Date.now() - pool.lastSampleTime > 10000) {
                pool.historyWinRates.push(pool.winRate);
                if(pool.historyWinRates.length > 30) pool.historyWinRates.shift();
                pool.avgWinRate5m = pool.historyWinRates.reduce((a,b)=>a+b,0) / pool.historyWinRates.length;
                pool.lastSampleTime = Date.now();
            }
        };
    }

    // 3. 渲染與排序
    function render() {
        const panel = document.getElementById('main-panel');
        const sorted = Object.keys(marketData).sort((a,b) => (ghostSymbols.has(b)-ghostSymbols.has(a)) || (marketData[b].isManual - marketData[a].isManual));

        sorted.forEach(s => {
            let item = marketData[s];
            let card = document.getElementById(`card-${s}`);
            if (!card) { card = document.createElement('div'); card.id = `card-${s}`; panel.prepend(card); }

            const isGhost = ghostSymbols.has(s);
            const trendUp = item.winRate > item.avgWinRate5m;
            const isAggressive = item.winRate > 75 || item.winRate < 25;

            card.className = `card-stat p-4 rounded-lg relative mb-2 ${isGhost ? 'ghost-border' : ''} ${isAggressive ? 'fire-bg' : ''}`;
            card.innerHTML = `
                <div class="flex justify-between items-start mb-2">
                    <div>
                        <div class="flex items-center gap-2">
                            <span class="font-bold text-white text-base">${s.replace('USDT','')}</span>
                            ${isGhost ? '<span class="tag-ghost">GHOST</span>' : ''}
                        </div>
                        <div class="text-[10px] text-zinc-500 font-mono italic">$${item.lastPrice.toLocaleString()}</div>
                    </div>
                    <div class="text-right">
                        <div class="text-[9px] text-zinc-600 uppercase">5m Avg: ${item.avgWinRate5m.toFixed(1)}%</div>
                        <div class="text-xl font-black ${item.winRate > 50 ? 'text-emerald-500' : 'text-red-500'}">${item.winRate.toFixed(1)}%</div>
                    </div>
                </div>
                <div class="h-4 w-full win-gradient rounded-sm relative mb-4 opacity-90">
                    <div class="win-pointer shadow-white/50" style="left: ${item.winRate}%"></div>
                </div>
                <div class="flex justify-between text-[10px] items-center font-bold">
                    <div class="${trendUp ? 'text-emerald-400' : 'text-red-400'}">
                        ${trendUp ? '▲ MOMENTUM UP' : '▼ MOMENTUM DECAY'}
                    </div>
                    <div class="text-zinc-500">POW: ${Math.abs(item.delta).toFixed(0)}</div>
                </div>
            `;
        });
    }

    function handleSearch() {
        const input = document.getElementById('search-input');
        const s = input.value.trim().toUpperCase();
        if (s) {
            const sym = s.endsWith('USDT') ? s : s + 'USDT';
            initStream(sym);
            if(marketData[sym]) marketData[sym].isManual = true;
            input.value = '';
        }
    }

    async function start() {
        await scanGhosts();
        setInterval(scanGhosts, 15000); 
        setInterval(render, 1000);
    }
    document.getElementById('search-input').addEventListener('keypress', (e) => { if(e.key==='Enter') handleSearch(); });
    start();
</script>
</body>
</html>
